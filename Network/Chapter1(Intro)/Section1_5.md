## 1.5 프로토콜 계층과 서비스 모델

**이렇게 복잡한.. 네트워크 구조를 어떻게 조직하는가?**

- 네트워크 구조에 대한 논의가 가능할까?

[가능하죠]

---

### 1.5.1 계층구조

- 계층구조는 크고 복잡한 시스템의 잘 정의된 특정 부분을 논의할 수 있게 해준다.
- 시스템이 계층구조를 가질 때, 그 계층이 제공하는 서비스의 구현을 변경하는 것도 매우 쉽다.
    - 계속해서 갱신되는 복잡하고 커다란 시스템의 경우, 시스템의 다른 요소에 영향을 주지 않고 서비스 구현을 변화시키는 능력은 계층화의 또 다른 중요한 이점이다.

**프로토콜 계층화**

- 네트워크 프로토콜의 설계 구조를 제공할 거면.
    - 네트워크 설계자는 프로토콜을 계층(layer)으로 조직한다.
    - 즉, **각각의 프로토콜은 한 계층에 속하며**, 프로토콜 계층은 소프트웨어, 하드웨어 또는 둘의 통합으로 구현할 수 있다.
    - 한 계층은 상위 계층에 제공하는 `서비스(service)`에 관심을 갖고, 이것을 계층의 `서비스 모델(service model)`이라고 한다.
        - 각 계층은 그 계층 내부에서 어떤 동작을 수행하거나, 직접 하위 계층의 서비스를 사용한다.
- 프로토콜 계층은 소프트웨어, 하드웨어 또는 둘의 통합으로 구현될 수 있다.
    - HTTP / SMTP 같은 애플리케이션 layer 프로토콜은 대부분 end point의 소프트웨어로 구현되며, transport layer 프로토콜도 마찬가지다.
    - physical layer, data link layer은 특정 링크상에 통신을 다루는 책임이 있으므로 그들은 전형적으로 부여된 리읔와 관련된 네트워크 인터페이스 카드로 구현된다.
    - network layer는 종종 하드웨어와 소프트웨어로 혼합 구현된다.
    - n계층 프로토콜이 네트워크를 구성하는 end point, packet switch, 그 외의 요소 사이에 **`분산`**된 것을 주목하자.
    - 즉, 각 네트워크 구성요소에는 하나의 n계층 프로토콜이 있다.
- 다양한 layer의 프로토콜을 모두 합하여 protocol stack이라고 한다.
    - 인터넷 프로토콜 스택은 5개 계층으로 구성된다.
    
    ![image](https://github.com/user-attachments/assets/84e407db-812a-4dd0-883d-7942f43d2bbf)

    
1. Application layer
    - 네트워크 애플리케이션 + 애플리케이션 계층 프로토콜이 있는 곳
    - HTTP / SMTP / FTP 같은 프로토콜을 포함
    - 도메인 네임 서버(domain name server, DNS)도 여기에 존재
    - 여러 end point에 분산되어 있어, 한 end point에 있는 애플리케이션이 다른 end point에 있는 애플리케이션과 **`정보 packet(message)`**을 교환하는데 이 프로토콜을 사용한다.

2. transport layer
    - 클라이언트와 서버 간에 애플리케이션 계층 메시지를 전송하는 서비스를 제공한다.
    - TCP / UDP 라는 두 가지 transport protocol이 있으며, 애플리케이션 계층 메시지를 전달한다.
        - TCP
            - 애플리케이션에게 연결지향형 서비스를 제공
            - 목적지로의 application layer message 전달 보장 / 흐름 제어를 포함한다.
            - 긴 메시지를 짧은 메시지로 나누고 혼잡 제어기능을 제공하여 네트워크가 혼잡할 때 출발지의 전송률을 줄이게 한다.
        - UDP
            - 애플리케이션에게 비연결형 서비스를 제공한다.
            - 신뢰성, 흐름 제어, 혼잡 제어를 제공하지 않는 아주 간단한 서비스
    - transport layer packet을 **`segment`**라고 한다.

3. network layer
    - 한 호스트에서 다른 호스트로 `데이터그램(datagram, IP의 전송 단위)`을 라우팅하는 책임을 진다.
    - 인터넷 transport layer protocol은 transport layer segment + end address를 network layer로 전달한다.
    - 두 가지 주요 요소를 갖는다.
        - IP datagram field를 정의하며 end point, router가 이 field에 어떻게 동작하는지를 정의하는 protocol을 가지고 있다.
            - = IP Protocol
            - 오직 하나의 IP Protocol이 있고, network layer를 가진 모든 인터넷 요소는 IP 프로토콜을 수행해야만 한다.
        - 출발지와 목적지 사이에서 datagram이 이동하는 경로를 결정하는 routing protocol을 포함한다.
            - 인터넷은 네트워크의 네트워크이며, 한 네트워크 내부에서 네트워크 운용자는 **원하는 어떠한 라우팅 프로토콜이라도 수행할 수 있다.**

4. link layer
    - 경로상의 한 노드(host / packet switch)에서 다른 노드로 packet을 이동하기 위해 network layer는 link layer service에 의존해야 한다.
        1. 각 노드에서 네트워크 계층은 데이터그램을 아래 링크 계층으로 보내고 **링크 계층은 그 데이터그램을 경로상의 다음 노드에 전달한다.**
        2. 다음 노드에서 링크 계층은 그 데이터그램을 상위 네트워크 계층으로 보낸다.
    - 링크 계층에서 제공하는 서비스는 그 링크에서 채용된 특정 링크 계층 프로토콜에 의해 결정된다.
        - 데이터그램은 출발지에서 목적지로 가는데 여러 링크를 거치므로, **데이터그램은 경로상의 각기 다른 링크에서 다른 링크 계층 프로토콜에 의해 처리될 수 있다.**
        - link layer packet을 `frame` 이라고 한다.

5. physical layer
    - 프레임 내부의 각 비트를 한 노드에서 다음 노드로 이동시킨다.
    - 이 계층의 프로토콜들은 링크에 의존하고, 더 나아가 링크의 실제 전송 매체(꼬임쌍선, 단일 모드 광케이블 등)에 의존한다.

---

### 1.5.2 캡슐화

![image 1](https://github.com/user-attachments/assets/d43601d9-f2c0-4ead-953a-956a4e3fcf0a)

- 그림은 아래 과정의 물리적 경로를 보여준다.
    1. **송신 종단 시스템**의 프로토콜 스택 아래로 데이터를 보내며
    2. 중간의 **링크 계층 스위치**와 **라우터의 프로토콜 스택**을 위아래로 거치고
    3. **수신 종단 시스템**의 프로토콜 스택 상위로 보낸다.
    
- **캡슐화** 개념의 중요성을 알 수 있다.
    1. 송신 호스트에서 `애플리케이션 계층 메시지(application-layer message, 위 그림에서의 M)`는 트랜스포트 계층으로 보내진다.
    2. 가장 간단한 경우, 트랜스포트 계층은 메시지에 수신 측 트랜스포트 계층에서 사용될 추가 정보인 `트랜스포트 계층 헤더 정보(Ht)`를 더한다.
        - 트랜스포트 계층 세그먼트(transport-layer segment) = 애플리케이션 계층 메시지 + 트랜스포트 계층 헤더 정보
        - 트랜스포트 계층 세그먼트는 애플리케이션 계층 메시지를 **캡슐화**한다.
        - 트랜스포트 계층 헤더 정보가 포함하는 내용은 다음과 같다.
            - 수신 측의 트랜스포트 계층이 그 메시지를 적절한 애플리케이션으로 보내도록 하는 정보들
            - 메시지의 비트들이 변경되었는지 아닌지를 수신자가 결정하게 하는 오류 검출 비트
    3. 트랜스포트 계층은 세그먼트를 네트워크 계층으로 보낸다.
    4. 네트워크 계층은 출발지와 목적지 종단 시스템 주소와 동일한 헤더 정보(Hn)를 추가하여 `네트워크 계층 데이터그램(network-layer datagram)`을 만든다.
    5. 데이터그램은 링크 계층으로 전달된다.
    6. 링크 계층도 자신의 헤더 정보를 추가하여 `링크 계층 프레임(link-layer frame)`을 만든다.
