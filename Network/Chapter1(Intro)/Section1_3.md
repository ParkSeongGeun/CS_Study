# 1.3 네트워크 코어

인터넷의 end point를 연결하는 packet switch와 link의 그물망(mesh)을 알아본다.

아래의 사진의 굵은 선은 네트워크 코어를 나타내고 있다.

![image](https://github.com/user-attachments/assets/248b12bf-9748-4f5b-b5e2-552c2cb9618f)

---

## 1.3.1 패킷 교환(packet switching)

- 네트워크 애플리케이션에서 end point들은 서로 메시지(message)를 교환한다.
- 출발지 end point에서 목적지 end point로 메시지를 보내기 위해 송신 시스템은 긴 메시지를 packet이라고 하는 작은 데이터 덩어리로 분할한다.
    - 송신 측과 수신 측 사이에서 각 packet은 통신 링크와 **`패킷 스위치(router || link-layer switch)`**를 거치게 된다.
    - packet은 링크의 **최대** 전송률과 같은 속도로 각각의 통신 링크에서 전송된다.
    - 따라서 출발지 end point 혹은 패킷 스위치가 **`R비트/초`**의 속도로 링크에서 **`L비트`**의 패킷을 송신한다면 그 패킷을 전송하는 데 걸리는 시간은 **`*L/R*`**초다.

### 저장-후-전달

- 대부분의 packet switch는 **`저장-후-전달 전송(store-and-forward transmission)`** 방식을 이용한다.
    - 이는 스위치가 **출력 링크로 packet의 첫 비트를 전송하기 전**에 **전체 packet을 받아야 함**을 의미한다.
    - 스위치는 뭐였고, 이건 무슨 말이지?
        - 스위치 → 네트워크에서 데이터 패킷을 받아서 적절한 목적지로 전달하는 네트워크 장비.
        - "저장-후-전달" 방식으로 동작한다는 것은 아래의 동작과 같음.
            1. 패킷 전체를 받아서 저장(버퍼에 임시 저장)
            2. 패킷의 목적지 확인
            3. 적절한 출력 포트로 전체 패킷을 전달
- 아래의 그림을 참고해보자.
    
    ![image 1](https://github.com/user-attachments/assets/9def10af-6ae9-491c-94bc-d2b31844e9e4)

    - 하나의 router로 연결되고, 2개의 end point로 구성된 간단한 네트워크이다.
    - router는 보통 여러 개의 링크를 갖는데 그 이유는 router의 기능이 입력되는 packet을 `출력 링크`로 교환하는 것이기 때문이다.
        - 입 / 출력 링크란?
            - 입력 링크(Input Link)
                - 패킷이 라우터나 스위치로 들어오는 연결 경로
                - 여러 입력 링크를 통해 동시에 여러 패킷이 들어올 수 있음
                - 각 입력 링크는 보통 버퍼(큐)를 가지고 있어 패킷을 임시 저장
            - 출력 링크(Output Link)
                - 패킷이 라우터나 스위치에서 나가는 연결 경로
                - 목적지로 향하는 다음 홉(hop)으로 패킷을 전송
                - 마찬가지로 버퍼를 가지고 있어 혼잡 상황에서 패킷을 대기시킬 수 있음
        - 위의 예에선 라우터가 하나의 (입력) 링크에서 유일한 다른 접속 링크로 packet을 전달하는 간단한 기능을 가진다.
    - 위의 사진에서의 출발지는 목적지로 전송할 3개의 packet을 갖고 있으며, 각각은 L비트로 구성된다.
    
    **[출발지에서 packet을 송신하기 시작해서 전체 packet을 목저기에서 수신할 때까지 경과 시간을 계산해보자]**
    
    ```
    1. 단일 패킷(패킷 1) 전송 시간
        - 시작: 출발지에서 패킷 1 전송 시작 (0초)
        - 1단계: 출발지→라우터 전송 완료 (L/R초)
        - 2단계: 라우터→목적지 전송 완료 (2L/R초)
        - 총 소요 시간: 2L/R초
            - L: 패킷의 길이(bits)
            - R: 전송 속도(bits/sec)
    2. 연속된 3개 패킷 전송 시간
        - 파이프라인 방식으로 전송이 이루어짐:
            - 라우터가 패킷 1을 목적지로 전송하는 동안 출발지는 패킷 2를 전송
            - 이런 방식으로 연속적으로 전송이 진행
        - 주요 시점:
            - L/R초: 첫 패킷이 라우터 도착
            - 2L/R초: 첫 패킷이 목적지 도착
            - 4L/R초: 마지막 패킷까지 모두 목적지 도착
        - 총 소요 시간: 4L/R초
    ```
    
    **[이제 출발지로부터 목적지 노드까지 N개의 링크로 구성되고 각각은 전송률이 R인 경로를 통해 하나의 패킷을 전송하는 일반적인 경우를 고려해보자]**
    
    - 출발지와 목적지 사이에 N-1개의 라우터가 있다.
    - 위와 같은 논리를 적용하면 종단 간 지연이 아래와 같다.
    
    $$
    d(종단 간 지연) = N * (L/R)
    $$
    

**[그렇다면 연속된 N개의 링크를 통해 송신된 P개 packet의 지연은..?]**

### 큐잉 지연과 패킷 손실

- 각 `packet switch`는 접속된 여러 개의 링크를 가지고 있다.
    - 각 링크에 대해 `packet switch`는 **`출력 버퍼(output buffer, output queue)`**를 갖고 있으며 그 링크로 송신하려고 하는 패킷을 저장하고 있다.
    - 만약 도착하는 패킷이 한 링크로 전송되어야 하는데, 그 링크가 다른 패킷을 전송하고 있다면?
        
        → “대기…”
        
    - 따라서 ‘**저장-후-전달**” 지연뿐만 아니라, packet은 출력 버퍼에서 **`queuing delay`**를 겪게 된다.
        - 가변적 / 네트워크의 혼잡 정도에 따른다.
    - 버퍼 공간의 크기가 유한하기 때문에 도착하는 패킷은 버퍼가 전송을 위해 대기 중인 다른 패킷들로 꽉 차 있는 경우를 당할 수 있다.
        - 이 경우 “**`packet loss`**”가 발생한다 → 도착 혹은 대기 중인 packet을 `drop`한다.
        - 1.4절에서 자세히 살펴본다.

### 포워딩 테이블과 라우팅 프로토콜

- 앞서 라우터는 접속된 통신 링크 중 하나로 도착하는 packet을 받아서 접속된 통신 링크 중 다른 링크로 그 packet을 전달한다고 했다.
    - 생각해보니.. 얘가 어느 링크로 전달할 지 어떻게 결정함??
    - packet 전달은 실제 여러 유형의 컴퓨터 네트워크에서 다른 방식으로 실행된다.
- 인터넷에서 모든 end point는 **`IP 주소`**라고 하는 주소를 갖는다.
    - 출발지 end point가 packet을 목적지 end point로 보내고자 할 때, 출발지는 **packet header에 목적지의 IP 주소를 포함**한다.
    - packet이 네트워크의 한 router에 도착한다.
    - 이 router는 packet의 목적지 주소의 일부를 조사하고 그 packet을 이웃 router로 전달한다.
        - 각 router는 **목적지 주소를 router의 출력 링크로 매핑**하는 **`포워딩 테이블(forwarding table)`**을 갖고 있다.
        - packet이 router에 도착하면 router는 올바른 출력 링크를 찾기 위해 주소를 조사하고 이 목적지 주소를 이용하여 forwarding table을 검색한다.
        - 그런 후에 router는 그 packet을 출력 링크로 보낸다.
    - 그런데 forwarding table은 어떻게 설정되는데?..
        - 인터넷은 자동으로 forwarding table을 설정하는데 이용되는 여러 특별한 **`라우팅 프로토콜(routing protocol)`**을 갖고 있다.
        - 예를 들어, routing protocol은 각 router로부터 각 목적지까지의 **최단 경로**를 결정하고 router에 forwarding table을 설정하는 데 이 최단 경로 결과를 이용한다.
        - 이건 5장에서 이야기한다.

---

## 1.3.2 회선 교환(circuit switching)

링크와 스위치의 네트워크를 통해 데이터를 이동시키는 방식

- 회선 교환(circuit switching)
- 패킷 교환(packet switching)

Circuit switching에서 end point 간에 통신을 제공하기 위해 경로상에 필요한 자원(buffer, link transmission rate)은 session 동안에 확보 또는 예약된다.

- packet switching은 X

Session message는 on-demand 방식으로 자원을 요청하여 사용하고 그 결과, 통신 링크에 대한 접속을 위해 기다릴 수도 있다.(queue)

- on-demand: 사용자가 필요할 때 즉시 자원을 요청하고, 그만큼만 비용을 지불하는 방식

대표적인 예로 전통적인 전화망이 있다.

![image 2](https://github.com/user-attachments/assets/cbb782a8-35f2-41b0-88bb-b8f896334b10)

- 송신자가 정보를 보내기 전, 네트워크는 sender와 receiver 연결 설정을 해야한다.
- 경로에 있는 switch들이 연결 상태를 유지해야한다.
- 네트워크가 circuit을 설정할 때, 그 연결이 이뤄지는 동안 네트워크 링크에 일정한 전송률을 예약한다.
- 주어진 전송률이 연결을 위해 예약되므로 sender는 receiver에게 보장된 일정 전송률로 데이터를 보낼 수 있다.

### Circuit switch 네트워크에서의 multiplexing

- 링크 내 한 circuit은 **`주파수 분할 다중화(frequency-division multiplexing, FDM)`** 혹은 **`시분할 다중화(time-division multiplexing, TDM)`**으로 구현된다.
    - FDM
        
        ![image 3](https://github.com/user-attachments/assets/d82f1b59-0dd1-4e10-b1a9-facbbef63c9f)

        - 링크를 통해 설정된 연결은 그 링크의 주파수 스펙트럼을 공유
        - 연결되는 동안 각 연결에 대해 주파수 대역을 고정
        - FM 라디오 방송도 FDM을 사용
    - TDM
        
        ![image 4](https://github.com/user-attachments/assets/1bc8982d-b511-450f-ab6f-21d4f06843df)

        - 시간을 일정 주기의 프레임으로 구분하고 각 프레임은 고정된 수의 시간 슬롯으로 나뉜다.
        - 네트워크가 링크를 통해 하나의 연결을 설정할 때, 네트워크는 모든 프레임에서 시간 슬롯 1개를 그 연결에 할당
        - 이들 슬롯은 그 연결을 위해 사용되도록 할당되고 그 연결의 데이터를 전송하기 위해 모든 프레임에 하나의 시간 슬롯을 갖게 된다.

- packet switching → “그럼 circuit switching은 할당된 회선이 놀 수도 있다. (silent period)

### packet switching VS circuit Switching

- Case 1
    
    > 사용자가 1 Mbps 링크를 공유한다고 가정하고, 각 사용자들은 활동 시간과 비활동 시간을 반복한다고 하자. 사용자는 전체 시간에서 10%만 활동하며 나머지 90% 시간에는 활동하지 않는다.
    > 
    - **회선 교환 방식:**
        - 각 사용자에게 100kbps 고정 할당
        - 1Mbps ÷ 100kbps = 최대 10명만 동시 사용 가능
        - 사용자가 비활동(90% 시간)이어도 대역폭 계속 점유
    - **패킷 교환 방식:**
        - 사용자가 데이터를 보낼 때만 대역폭 사용
        - 각 사용자는 10% 시간만 활동
        - 35명의 사용자가 있어도:
            - 10명 이상이 동시에 활동할 확률은 0.04%로 매우 낮음
            - 대부분의 경우 지연 없이 데이터 전송 가능
            - 최대 약 35명까지 수용 가능
        
        결론: 패킷 교환이 회선 교환보다 3배 이상 효율적으로 대역폭 활용 가능
        
- Case 2
    
    > 10명의 사용자가 있다고 가정하자. 1번과 동일하게, 사용자는 1 Mbps 링크를 공유한다.
    한 사용자가 한번에 1,000비트 패킷을 1,000개 생성하고 다른 사용자는 패킷을 생성하지 않는다.
    > 
    - **회선 교환:**
        - 각 프레임: 10개 시간 슬롯, 슬롯당 1,000비트
        - 사용자는 프레임당 1개 슬롯만 사용 가능
        - 나머지 9개 슬롯은 낭비
        - 전체 전송 시간: 10초
    - **패킷 교환:**
        - 다른 사용자가 없어 전체 대역폭 사용 가능
        - 1Mbps 속도로 연속 전송
        - 전체 전송 시간: 1초
        
        결론: 이 경우 패킷 교환이 10배 더 효율적
        

**앞의 예 2가지로는 packet switching이 circuit switching보다 성능적으로 더 우수하다.**

- 가장 큰 차이
    - circuit switching이 demand에 관계없이 전송 링크의 사용을 할당하는 반면
    - packet switching은 on-demand 상황에서의 링크 사용만을 할당한다.
- 점점 packet switching으로 전환되는 추세

---

### 1.3.3 네트워크의 네트워크

- end point 사용자들과 Content provider들을 접속 ISP로 연결하는 것은 인터넷을 구성하는 많은 end point system을 연결하는 것 중 일부분이다.
    - 이를 위해 **네트워크의 네트워크**가 탄생하게 되었다.
    - `ISP(Internet Service Provider)` : 패킷 스위치와 통신 링크로 이루어진 네트워크
- 목표: **모든 end point가 서로에게 packet을 보낼 수 있도록 접속 ISP를 연결하는 것**

**How?**

1. 그냥 접속 ISP들을 서로 연결시켜 주는 것. → **하나의 글로벌 ISP**
    - 그물망 설계
    - 모든 접속 ISP들을 하나의 글로벌 통합(transit) ISP와 연결
2. 수십만 개의 접속 ISP와 **다중의 글로벌 ISP**
    - 2계층구조
        - 상위층 : 글로벌 ISP 서비스 제공자가 존재
        - 하위층 : 접속 ISP가 존재
3. **`다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP)`**
    - **1계층 ISP**
        - 최상위 계층
        - 요금 지불하지 않음
        - 글로벌 인터넷 연결성 제공
    - **지역 ISP**
        - 1계층 ISP에 요금 지불
        - 접속 ISP에 서비스 제공
        - 한 지역에 여러 ISP 경쟁 가능
    - **접속 ISP**
        - 최하위 계층
        - 지역 ISP에 요금 지불
        - 최종 사용자에게 직접 서비스 제공
4. 다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP) + **PoP + 멀티홈 + 피어링 + IXP**
    - **PoP (Points of Presence)**
        - 제공자 네트워크 내 라우터 그룹
        - 고객 ISP가 제공자 ISP에 연결되는 지점
        - 제3자로부터 고속 링크 임대 가능
    - **멀티홈 (Multi-homing)**
        - 여러 제공자 ISP에 동시 연결
        - 네트워크 신뢰성 향상
        - 한 ISP 연결 실패해도 서비스 유지
    - **피어링 (Peering)**
        - 같은 계층 ISP간 직접 연결
        - 상위 계층 우회로 비용 절감
        - 일반적으로 상호 무료
    - **IXP (Internet Exchange Point)**
        - ISP들의 피어링 집중 지점
        - 효율적인 트래픽 교환
        - 독립 시설에 위치
5. 다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP) + PoP + 멀티홈 + 피어링 + IXP + **콘텐츠 제공 네트워크**
    
    ![image 5](https://github.com/user-attachments/assets/de68d36d-6903-4609-be2e-04aaae73daf0)

    - 구글의 사설 네트워크 구조
        - **핵심 특징**
            - 전용 TCP/IP 네트워크로 전 세계 데이터센터 연결
            - 공용 인터넷과 분리
            - 구글 서버 트래픽만 전담 처리
        - **연결 방식**
            - 하위 ISP와 직접 피어링
            - IXP 활용
            - 1계층 ISP 연결 유지 (일부 접속 ISP 도달용)
        - **이점**
            1. 비용 절감
                - 상위 ISP 우회로 요금 절감
                - 효율적인 트래픽 관리
            2. 서비스 통제력 강화
                - 사용자 서비스 품질 직접 관리
                - 데이터 전송 경로 최적화

**정리**

- 오늘날의 **인터넷(네트워크의 네트워크)**는 12개 정도의 1계층 ISP들과 수십만 개의 하위 계층 ISP들로 구성된다.
    - 하위 계층 ISP들은 상위 계층 ISP들과 연결하고, 상위 계층 ISP들은 서로 연결함
    - 사용자와 콘텐츠 제공자는 하위 계층 ISP들의 고객
    - 하위 계층 ISP들은 상위 계층 ISP들의 고객
    - 최근에는 주요 콘텐츠 제공자들도 자신의 네트워크를 구축, 가능한 곳에서 하위 계층 ISP들과 직접 연결
